<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Instagram 一括モニター ×18</title>
<style>
  :root{
    --frame-w: 360px;
    --frame-h: 500px;
    --scale: 0.62;
    --cols: 6;
    --gap: 6px;
  }
  *{ box-sizing:border-box; margin:0; padding:0; }
  body{
    margin:0; background:#fafafa;
    font-family:"Noto Sans JP",system-ui,sans-serif;
  }
  header{
    position:sticky; top:0; z-index:2;
    background:#ffffffee; backdrop-filter:blur(6px);
    border-bottom:1px solid #ddd; 
    padding:4px 8px;
    display:flex; flex-wrap:wrap; align-items:center; 
    gap:8px; justify-content:space-between;
  }
  .title{ font-size:14px; font-weight:600; }
  .controls{ 
    display:flex; gap:6px; flex-wrap:wrap; 
    align-items:center; font-size:12px; 
  }
  select,button,input[type="range"]{
    font:inherit; padding:3px 6px; 
    border:1px solid #ccc; border-radius:4px; 
    background:#fff; font-size:11px;
  }
  input[type="range"]{ width:80px; }
  .hint{ font-size:10px; color:#888; margin-left:4px; }

  .grid{
    display:grid;
    grid-template-columns:repeat(var(--cols), calc(var(--frame-w)*var(--scale)));
    gap:var(--gap);
    justify-content:center;
    padding:4px;
  }
  .card{
    width:calc(var(--frame-w)*var(--scale));
    border:1px solid #ddd; border-radius:4px; 
    background:#fff; overflow:hidden;
  }
  .meta{
    font-size:10px; padding:2px 4px; 
    border-bottom:1px solid #eee;
    display:flex; justify-content:space-between; 
    align-items:center; line-height:1.3;
  }
  .meta a{ 
    text-decoration:none; color:#0095f6;
    border:1px solid #ddd; border-radius:3px; 
    padding:1px 4px; font-size:9px; 
  }
  .meta a:hover{ background:#f0f0f0; }
  .scale-wrap{
    width:calc(var(--frame-w)*var(--scale));
    height:calc(var(--frame-h)*var(--scale));
    overflow:hidden; position:relative;
  }
  .scale-inner{
    width:var(--frame-w); height:var(--frame-h);
    transform:scale(var(--scale)); transform-origin:top left;
  }
  iframe{ width:100%; height:100%; border:0; display:block; }

  @media (max-width: 2000px){ :root{ --cols:7; } }
  @media (max-width: 1700px){ :root{ --cols:6; } }
  @media (max-width: 1400px){ :root{ --cols:5; } }
  @media (max-width: 1100px){ :root{ --cols:4; } }
  @media (max-width: 900px) { :root{ --cols:3; } }
  @media (max-width: 650px) { :root{ --cols:2; } }
  @media (max-width: 450px) { :root{ --cols:1; } }
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
    <span class="title">Instagram 一括モニター ×18</span>
    <span class="hint">余白は「高さ」で調整</span>
  </div>
  <div class="controls">
    <label>密度
      <select id="densitySelect">
        <option value="4">快適（4列）</option>
        <option value="5">標準（5列）</option>
        <option value="6" selected>コンパクト（6列）</option>
        <option value="7">超密（7列）</option>
        <option value="8">最大（8列）</option>
      </select>
    </label>
    <label>高さ
      <input id="heightRange" type="range" min="300" max="500" step="10" value="500" />
      <span id="heightDisplay" style="font-size:10px;color:#666;">500</span>
    </label>
    <label>更新
      <select id="intervalSelect">
        <option value="0">OFF</option>
        <option value="300000">5分</option>
        <option value="600000" selected>10分</option>
        <option value="900000">15分</option>
      </select>
    </label>
    <button id="refreshBtn">🔄</button>
  </div>
</header>

<main class="grid" id="grid"></main>

<script>
const usernames = [
  "okamura_koumuten","karada_4590","mayasound8","yamatosangyo_kyoto",
  "tamayobi_official","allespetaplus","nagasawa0208","trys_fudosan_hisatoshimada",
  "villa_amatsuboshi","mist_watasi","pety.official.store","fullbrain2025",
  "plus.one_osaka","mikataokinawa","GELpress.japan","outdoorchair_lab",
  "marklis.web.marketing","azzurro_tokyo"
];

const grid = document.getElementById("grid");
const densitySelect = document.getElementById("densitySelect");
const heightRange = document.getElementById("heightRange");
const heightDisplay = document.getElementById("heightDisplay");
const intervalSelect = document.getElementById("intervalSelect");
const refreshBtn = document.getElementById("refreshBtn");

function createCard(name){
  const card = document.createElement("div");
  card.className = "card";

  const meta = document.createElement("div");
  meta.className = "meta";
  meta.innerHTML = `<span>@${name}</span>
    <a href="https://www.instagram.com/${name}/" target="_blank" rel="noopener">開く</a>`;

  const wrap = document.createElement("div");
  wrap.className = "scale-wrap";
  const inner = document.createElement("div");
  inner.className = "scale-inner";
  const iframe = document.createElement("iframe");
  iframe.loading = "lazy";
  iframe.src = `https://www.instagram.com/${name}/embed`;

  inner.appendChild(iframe);
  wrap.appendChild(inner);
  card.append(meta, wrap);
  return card;
}

function render(){
  grid.innerHTML = "";
  usernames.forEach(u => grid.appendChild(createCard(u)));
}

function applyDensity(cols){
  const r = document.documentElement.style;
  const settings = {
    4: { w: 380, scale: 0.75 },
    5: { w: 360, scale: 0.68 },
    6: { w: 340, scale: 0.62 },
    7: { w: 320, scale: 0.56 },
    8: { w: 300, scale: 0.50 }
  };
  const s = settings[cols] || settings[6];
  r.setProperty("--cols", cols);
  r.setProperty("--frame-w", s.w + "px");
  r.setProperty("--scale", s.scale);
}

function applyHeight(px){
  document.documentElement.style.setProperty("--frame-h", px + "px");
  heightDisplay.textContent = px;
  localStorage.setItem("ig_dashboard_frame_h", String(px));
}

let timer = null;
function setAutoRefresh(ms){
  if(timer) clearInterval(timer);
  if(ms && Number(ms)>0){
    timer = setInterval(()=>refreshIframes(), Number(ms));
  }
}

function refreshIframes(){
  document.querySelectorAll("iframe").forEach(f=>{
    const url = new URL(f.src);
    url.searchParams.set("_t", Date.now());
    f.src = url.toString();
  });
}

render();
applyDensity(Number(densitySelect.value));

const savedH = Number(localStorage.getItem("ig_dashboard_frame_h") || "0");
if(savedH){ 
  heightRange.value = savedH; 
  applyHeight(savedH); 
} else { 
  applyHeight(Number(heightRange.value)); 
}

setAutoRefresh(intervalSelect.value);

densitySelect.onchange = e => applyDensity(Number(e.target.value));
heightRange.oninput = e => applyHeight(Number(e.target.value));
intervalSelect.onchange = e => setAutoRefresh(e.target.value);
refreshBtn.onclick = () => refreshIframes();
</script>

</body>
</html>