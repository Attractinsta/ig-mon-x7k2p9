<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Instagram 一括モニター</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  background: #fafafa;
  color: #262626;
}

/* ヘッダー */
header {
  background: #fff;
  border-bottom: 1px solid #dbdbdb;
  padding: 12px 16px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
}

h1 {
  font-size: 18px;
  font-weight: 600;
  color: #262626;
  display: flex;
  align-items: center;
  gap: 8px;
}

.account-count {
  font-size: 14px;
  font-weight: 500;
  color: #8e8e8e;
  background: #efefef;
  padding: 2px 8px;
  border-radius: 12px;
}

.controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.control-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.control-item label {
  font-size: 14px;
  color: #8e8e8e;
  white-space: nowrap;
}

select {
  padding: 6px 12px;
  border: 1px solid #dbdbdb;
  border-radius: 6px;
  background: #fff;
  font-size: 14px;
  cursor: pointer;
  outline: none;
}

select:hover {
  border-color: #b2b2b2;
}

button {
  padding: 6px 16px;
  background: #0095f6;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

button:hover {
  background: #1877f2;
}

button:active {
  background: #0064d8;
}

/* グリッドコンテナー */
.grid-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

.grid {
  display: grid;
  gap: 16px;
}

/* PC: デフォルト（選択可能） */
@media (min-width: 1025px) {
  .grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
  .grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
  .grid.cols-5 { grid-template-columns: repeat(5, 1fr); }
  .grid.cols-6 { grid-template-columns: repeat(6, 1fr); }
  .grid.cols-8 { grid-template-columns: repeat(8, 1fr); }
}

/* タブレット: 2列固定 */
@media (min-width: 641px) and (max-width: 1024px) {
  .grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .pc-only {
    display: none;
  }
}

/* スマホ: 1列固定 */
@media (max-width: 640px) {
  .grid {
    grid-template-columns: 1fr !important;
  }
  
  .pc-only {
    display: none;
  }
  
  .grid-container {
    padding: 12px;
  }
  
  .grid {
    gap: 12px;
  }
  
  h1 {
    font-size: 16px;
  }
  
  .controls {
    width: 100%;
  }
  
  .control-item {
    flex: 1;
    min-width: 100px;
  }
  
  select {
    width: 100%;
  }
}

/* カード */
.card {
  background: #fff;
  border: 1px solid #dbdbdb;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  transition: box-shadow 0.2s;
}

.card:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.12);
}

.card-header {
  padding: 10px 12px;
  background: #fafafa;
  border-bottom: 1px solid #efefef;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.username {
  font-size: 13px;
  font-weight: 600;
  color: #262626;
}

.open-link {
  font-size: 12px;
  color: #0095f6;
  text-decoration: none;
  padding: 4px 10px;
  border: 1px solid #0095f6;
  border-radius: 4px;
  transition: all 0.2s;
}

.open-link:hover {
  background: #0095f6;
  color: #fff;
}

.iframe-container {
  width: 100%;
  position: relative;
  background: #fff;
  overflow: hidden;
  height: 600px;
}

iframe {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 340px;
  height: 600px;
  border: none;
  transform-origin: top center;
}

/* 列数に応じてiframeをスケール */
@media (min-width: 1025px) {
  .grid.cols-3 iframe { transform: translateX(-50%) scale(1); }
  .grid.cols-4 iframe { transform: translateX(-50%) scale(0.85); }
  .grid.cols-5 iframe { transform: translateX(-50%) scale(0.70); }
  .grid.cols-6 iframe { transform: translateX(-50%) scale(0.58); }
  .grid.cols-8 iframe { transform: translateX(-50%) scale(0.45); }
  
  .grid.cols-3 .iframe-container { height: 600px; }
  .grid.cols-4 .iframe-container { height: 510px; }
  .grid.cols-5 .iframe-container { height: 420px; }
  .grid.cols-6 .iframe-container { height: 350px; }
  .grid.cols-8 .iframe-container { height: 270px; }
}

/* タブレット: 2列 */
@media (min-width: 641px) and (max-width: 1024px) {
  .iframe-container { height: 550px; }
  iframe { transform: translateX(-50%) scale(0.90); }
}

/* スマホ: 1列 */
@media (max-width: 640px) {
  .iframe-container { height: 600px; }
  iframe { 
    transform: translateX(-50%) scale(1);
    width: 100%;
    max-width: 340px;
  }
}

/* ローディング状態 */
.loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #8e8e8e;
  font-size: 14px;
}

/* スクロールバーのスタイリング */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #fafafa;
}

::-webkit-scrollbar-thumb {
  background: #dbdbdb;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #b2b2b2;
}

/* レスポンシブ調整 */
@media (max-width: 640px) {
  .card-header {
    padding: 8px 10px;
  }
  
  .username {
    font-size: 12px;
  }
  
  .open-link {
    font-size: 11px;
    padding: 3px 8px;
  }
}
</style>
</head>
<body>

<header>
  <div class="header-content">
    <h1>
      📱 Instagram モニター
      <span class="account-count" id="accountCount">×18</span>
    </h1>
    <div class="controls">
      <div class="control-item pc-only">
        <label>列数:</label>
        <select id="colSelect">
          <option value="3">3列</option>
          <option value="4" selected>4列</option>
          <option value="5">5列</option>
          <option value="6">6列</option>
          <option value="8">8列</option>
        </select>
      </div>
      <div class="control-item">
        <label>更新:</label>
        <select id="refreshSelect">
          <option value="0">OFF</option>
          <option value="300000">5分</option>
          <option value="600000" selected>10分</option>
          <option value="900000">15分</option>
        </select>
      </div>
      <button id="refreshBtn">🔄 更新</button>
    </div>
  </div>
</header>

<div class="grid-container">
  <div class="grid cols-4" id="grid"></div>
</div>

<script>
// ★ アカウントリスト - ここに追加していくだけでOK
const accounts = [
  "okamura_koumuten",
  "karada_4590",
  "mayasound8",
  "yamatosangyo_kyoto",
  "tamayobi_official",
  "allespetaplus",
  "nagasawa0208",
  "trys_fudosan_hisatoshimada",
  "villa_amatsuboshi",
  "mist_watasi",
  "pety.official.store",
  "fullbrain2025",
  "plus.one_osaka",
  "mikataokinawa",
  "GELpress.japan",
  "outdoorchair_lab",
  "marklis.web.marketing",
  "azzurro_tokyo"
  // ★ ここに追加で何個でも増やせます
  // "new_account_1",
  // "new_account_2",
  // ...
];

const grid = document.getElementById('grid');
const colSelect = document.getElementById('colSelect');
const refreshSelect = document.getElementById('refreshSelect');
const refreshBtn = document.getElementById('refreshBtn');
const accountCount = document.getElementById('accountCount');

let refreshTimer = null;

// アカウント数を表示
accountCount.textContent = `×${accounts.length}`;

// カード作成（変更なし）
function createCard(username) {
  const card = document.createElement('div');
  card.className = 'card';
  
  card.innerHTML = `
    <div class="card-header">
      <span class="username">@${username}</span>
      <a href="https://www.instagram.com/${username}/" target="_blank" rel="noopener noreferrer" class="open-link">開く</a>
    </div>
    <div class="iframe-container">
      <div class="loading">読み込み中...</div>
      <iframe 
        data-src="https://www.instagram.com/${username}/embed"
        title="${username}"
        loading="lazy"
        sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
      </iframe>
    </div>
  `;
  
  return card;
}

// グリッド初期化
function initGrid() {
  grid.innerHTML = '';
  accounts.forEach(username => {
    grid.appendChild(createCard(username));
  });
  
  // Intersection Observerで遅延読み込み
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const iframe = entry.target;
        if (iframe.dataset.src && !iframe.src) {
          iframe.src = iframe.dataset.src;
          observer.unobserve(iframe);
        }
      }
    });
  }, {
    rootMargin: '200px'
  });
  
  document.querySelectorAll('iframe').forEach(iframe => {
    observer.observe(iframe);
  });
}

// 列数変更
function updateColumns(cols) {
  grid.className = `grid cols-${cols}`;
  try {
    localStorage.setItem('ig-monitor-cols', cols);
  } catch(e) {}
}

// 自動更新設定
function setupAutoRefresh(interval) {
  if (refreshTimer) {
    clearInterval(refreshTimer);
    refreshTimer = null;
  }
  
  if (interval > 0) {
    refreshTimer = setInterval(refreshAll, interval);
  }
  
  try {
    localStorage.setItem('ig-monitor-refresh', interval);
  } catch(e) {}
}

// 全iframe更新
function refreshAll() {
  document.querySelectorAll('iframe').forEach(iframe => {
    if (iframe.src) {
      const url = iframe.dataset.src || iframe.src.split('?')[0];
      iframe.src = `${url}?t=${Date.now()}`;
    }
  });
}

// イベントリスナー
colSelect.addEventListener('change', (e) => {
  updateColumns(e.target.value);
});

refreshSelect.addEventListener('change', (e) => {
  setupAutoRefresh(parseInt(e.target.value));
});

refreshBtn.addEventListener('click', refreshAll);

// 初期化
initGrid();

// 保存された設定を読み込み
try {
  const savedCols = localStorage.getItem('ig-monitor-cols');
  if (savedCols) {
    colSelect.value = savedCols;
    updateColumns(savedCols);
  }
  
  const savedRefresh = localStorage.getItem('ig-monitor-refresh');
  if (savedRefresh) {
    refreshSelect.value = savedRefresh;
    setupAutoRefresh(parseInt(savedRefresh));
  } else {
    setupAutoRefresh(600000); // デフォルト10分
  }
} catch(e) {
  setupAutoRefresh(600000);
}
</script>

</body>
</html>
